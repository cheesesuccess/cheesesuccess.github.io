<!doctype html>
<html lang='en-US'>
  <head>
    <title>Osho Digital Library</title>
    <meta charset='UTF-8'>
    <base href='./'>
    <!-- Stripe Buy Button (needed only if you use Buy Buttons) -->
    <script async src="https://js.stripe.com/v3/buy-button.js"></script>
    <!--
      TODO. For now only Chrome supports 'unsafe-hashes' option.
      When other browsers support it, it is safer to use it than 'unsafe-hashes'.
      script-src: 'unsafe-hashes' 'sha256-nNExX8dGhf3ce7nlLMW210YbT1+ATSaoMpg5lf/l+Ng='
    -->
    <meta http-equiv='Content-Security-Policy' content="
      default-src 'none';
      connect-src 'self' blob: *;
      script-src 'self' blob: 'unsafe-inline' https://gc.zgo.at/;
      style-src 'self' 'unsafe-inline';
      font-src 'self';
      manifest-src 'self';
      img-src 'self' blob: https://snaeplayer.goatcounter.com/count https://oshoworld.com;
      media-src 'self' blob: *;
      child-src 'self' blob:;
      form-action 'none';
      base-uri 'none';
    ">
    <meta name='viewport' content='width=device-width, initial-scale=1, user-scalable=no'>
    <meta name='theme-color' content='transparent'>
    <meta name='description' content='A comprehensive digital library of Osho teachings and discourses.'>
    <link rel='icon' href='/icons/icon_responsive.svg' type='image/svg+xml' />
    <link rel="alternate icon" href="/icons/icon_16.png" sizes="16x16" type="image/png" />
    <link rel='apple-touch-icon' href='/icons/apple-touch-icon.png' sizes='180x180' />

    <!-- Hidden image for color extraction -->
    <img id="coverImage" src="path/to/your/image.jpg" crossOrigin="anonymous" style="display:none;">

    <!-- Include Color Thief library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.2/color-thief.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const img = document.getElementById('coverImage');
        const colorThief = new ColorThief();

        function updateThemeColor() {
          if (img.complete) {
            try {
              const dominantColor = colorThief.getColor(img);
              const hexColor = rgbToHex(dominantColor[0], dominantColor[1], dominantColor[2]);
              const themeMeta = document.querySelector('meta[name="theme-color"]');
              if (themeMeta) {
                themeMeta.setAttribute('content', hexColor);
              }
            } catch (error) {
              console.error("Error extracting color:", error);
            }
          } else {
            // If image not loaded yet, try again when loaded
            img.onload = () => {
              updateThemeColor();
            };
          }
        }

        // Convert RGB to HEX
        function rgbToHex(r, g, b) {
          return "#" + [r, g, b].map(x => {
            const hex = x.toString(16);
            return hex.length === 1 ? "0" + hex : hex;
          }).join('');
        }

        // Trigger color extraction
        updateThemeColor();

        // Optional: re-update if the image source changes dynamically
        // You can set up a MutationObserver or call updateThemeColor() when needed
      });
    </script>
  </head>
  <body>
    <noscript>
      Please enable Javascript in order to use this app.
    </noscript>
    <div id='unsupported-browser' hidden>
      <div>This browser does not support required technologies for this app to function correctly.</div>
      <div>Please upgrade your browser to the latest version of:</div>
      <a href='https://www.mozilla.org/en-US/firefox/new/'>Firefox</a>
      <a href='https://www.microsoft.com/en-us/windows/microsoft-edge'>Edge</a>
      <a href='https://www.google.com/chrome/'>Chrome</a>
      <a href='https://www.apple.com/safari/'>Safari</a>
    </div>

    <script type='module' src='./src/index.ts'></script>
    <script nomodule src="/nomodule.js"></script>
    <script
      src='https://gc.zgo.at/count.js'
      data-goatcounter='https://snaeplayer.goatcounter.com/count'
      crossorigin='anonymous'
      async
    >
    </script>
  </body>
</html>
